(function(){"use strict";function O(t,n){return typeof t>"u"?n:t}function I(t){const n=Array(t);for(let e=0;e<t;e++)n[e]=a();return n}function Z(t){return Object.keys(t)}function a(){return Object.create(null)}function D(t){return[].concat.apply([],t)}function F(t,n){return n.length-t.length}function G(t){return t.constructor===Array}function b(t){return typeof t=="string"}function $(t){return typeof t=="object"}function H(t){return typeof t=="function"}function K(t,n,e,i){if(t&&(n&&(t=C(t,n)),this.matcher&&(t=C(t,this.matcher)),this.stemmer&&1<t.length&&(t=C(t,this.stemmer)),i&&1<t.length&&(t=V(t)),e||e==="")){const r=t.split(e);return this.filter?W(r,this.filter):r}return t}const Q=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function U(t){const n=a();for(let e=0,i=t.length;e<i;e++)n[t[e]]=1;return n}function S(t,n){const e=Z(t),i=e.length,r=[];let o="",s=0;for(let h,p,l=0;l<i;l++)h=e[l],p=t[h],p?(r[s++]=E(n?"(?!\\b)"+h+"(\\b|_)":h),r[s++]=p):o+=(o?"|":"")+h;return o&&(r[s++]=E(n?"(?!\\b)("+o+")(\\b|_)":"("+o+")"),r[s]=""),r}function C(t,n){for(let e=0,i=n.length;e<i&&(t=t.replace(n[e],n[e+1]),!!t);e+=2);return t}function E(t){return new RegExp(t,"g")}function V(t){let n="",e="";for(let i,r=0,o=t.length;r<o;r++)(i=t[r])!==e&&(n+=e=i);return n}function W(t,n){const e=t.length,i=[];for(let r=0,o=0;r<e;r++){const s=t[r];s&&!n[s]&&(i[o++]=s)}return i}function X(t){return K.call(this,(""+t).toLowerCase(),!1,Q,!1)}const Y={},tt={};function et(t){q(t,"add"),q(t,"append"),q(t,"search"),q(t,"update"),q(t,"remove")}function q(t,n){t[n+"Async"]=function(){const e=this,i=arguments,r=i[i.length-1];let o;H(r)&&(o=r,delete i[i.length-1]);const s=new Promise(function(h){setTimeout(function(){e.async=!0;const p=e[n].apply(e,i);e.async=!1,h(p)})});return o?(s.then(o),this):s}}function nt(t,n,e,i){const r=t.length;let o,s,h=[],p=0;i&&(i=[]);for(let l=r-1;0<=l;l--){const u=t[l],c=u.length,d=a();let f=!o;for(let g=0;g<c;g++){const y=u[g],_=y.length;if(_)for(let k,x,w=0;w<_;w++)if(x=y[w],o){if(o[x]){if(!l){if(e)e--;else if(h[p++]=x,p===n)return h}(l||i)&&(d[x]=1),f=!0}if(i&&(k=(s[x]||0)+1,s[x]=k,k<r)){const z=i[k-2]||(i[k-2]=[]);z[z.length]=x}}else d[x]=1}if(i)o||(s=d);else if(!f)return[];o=d}if(i)for(let l,u,c=i.length-1;0<=c;c--){l=i[c],u=l.length;for(let d,f=0;f<u;f++)if(d=l[f],!o[d]){if(e)e--;else if(h[p++]=d,p===n)return h;o[d]=1}}return h}function j(t){this.limit=t!==!0&&t,this.cache=a(),this.queue=[]}function it(t,n,e){$(t)&&(t=t.query);let i=this.cache.get(t);return i||(i=this.search(t,n,e),this.cache.set(t,i)),i}j.prototype.set=function(t,n){if(!this.cache[t]){let e=this.queue.length;e===this.limit?delete this.cache[this.queue[e-1]]:e++;for(let i=e-1;0<i;i--)this.queue[i]=this.queue[i-1];this.queue[0]=t}this.cache[t]=n},j.prototype.get=function(t){const n=this.cache[t];if(this.limit&&n){const e=this.queue.indexOf(t);if(e){const i=this.queue[e-1];this.queue[e-1]=this.queue[e],this.queue[e]=i}}return n},j.prototype.del=function(t){for(let n,e,i=0;i<this.queue.length;i++)e=this.queue[i],n=this.cache[e],n.includes(t)&&(this.queue.splice(i--,1),delete this.cache[e])};const st={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function rt(t){if(b(t))t=st[t];else{const n=t.preset;n&&(t=Object.assign({},n[n],t))}return t}function ot(t,n,e,i,r,o,s){setTimeout(function(){const h=t(e?e+"."+i:i,JSON.stringify(s));h&&h.then?h.then(function(){n.export(t,n,e,r,o+1)}):n.export(t,n,e,r,o+1)})}function ht(t,n,e,i,r){let o,s;switch(r||(r=0)){case 0:if(o="reg",this.fastupdate)for(let h in s=a(),this.register)s[h]=1;else s=this.register;break;case 1:o="cfg",s={doc:0,opt:this.optimize?1:0};break;case 2:o="map",s=this.map;break;case 3:o="ctx",s=this.ctx;break;default:return}return ot(t,n||this,e,o,i,r,s),!0}function ct(t,n){n&&(b(n)&&(n=JSON.parse(n)),t==="cfg"?this.optimize=!!n.opt:t==="reg"?(this.fastupdate=!1,this.register=n):t==="map"?this.map=n:t==="ctx"&&(this.ctx=n))}function m(t,n){if(!(this instanceof m))return new m(t);let e,i,r;t?(t=rt(t),e=t.charset,i=t.lang,b(e)&&(e.indexOf(":")===-1&&(e+=":default"),e=tt[e]),b(i)&&(i=Y[i])):t={};let o,s,h=t.context||{};this.encode=t.encode||e&&e.encode||X,this.register=n||a(),this.resolution=o=t.resolution||9,this.tokenize=r=e&&e.tokenize||t.tokenize||"strict",this.depth=r==="strict"&&h.depth,this.bidirectional=O(h.bidirectional,!0),this.optimize=s=O(t.optimize,!0),this.fastupdate=O(t.fastupdate,!0),this.minlength=t.minlength||1,this.boost=t.boost,this.map=s?I(o):a(),this.resolution_ctx=o=h.resolution||1,this.ctx=s?I(o):a(),this.rtl=e&&e.rtl||t.rtl,this.matcher=(r=t.matcher||i&&i.matcher)&&S(r,!1),this.stemmer=(r=t.stemmer||i&&i.stemmer)&&S(r,!0),this.filter=(r=t.filter||i&&i.filter)&&U(r),this.cache=(r=t.cache)&&new j(r)}m.prototype.append=function(t,n){return this.add(t,n,!0)},m.prototype.add=function(t,n,e,i){if(n&&(t||t===0)){if(!i&&!e&&this.register[t])return this.update(t,n);n=this.encode(""+n);const r=n.length;if(r){const o=a(),s=a(),h=this.depth,p=this.resolution;for(let l=0;l<r;l++){let u=n[this.rtl?r-1-l:l],c=u.length;if(u&&c>=this.minlength&&(h||!s[u])){let d=v(p,r,l),f="";switch(this.tokenize){case"full":if(2<c){for(let g=0;g<c;g++)for(let y=c;y>g;y--)if(y-g>=this.minlength){const _=v(p,r,l,c,g);f=u.substring(g,y),this.push_index(s,f,_,t,e)}break}case"reverse":if(1<c){for(let g=c-1;0<g;g--)if(f=u[g]+f,f.length>=this.minlength){const y=v(p,r,l,c,g);this.push_index(s,f,y,t,e)}f=""}case"forward":if(1<c){for(let g=0;g<c;g++)f+=u[g],f.length>=this.minlength&&this.push_index(s,f,d,t,e);break}default:if(this.boost&&(d=Math.min(0|d/this.boost(n,u,l),p-1)),this.push_index(s,u,d,t,e),h&&1<r&&l<r-1){const g=a(),y=this.resolution_ctx,_=u,k=Math.min(h+1,r-l);g[_]=1;for(let x=1;x<k;x++)if(u=n[this.rtl?r-1-l-x:l+x],u&&u.length>=this.minlength&&!g[u]){g[u]=1;const w=v(y+(r/2>y?0:1),r,l,k-1,x-1),z=this.bidirectional&&u>_;this.push_index(o,z?_:u,w,t,e,z?u:_)}}}}}this.fastupdate||(this.register[t]=1)}}return this};function v(t,n,e,i,r){return e&&1<t?n+(i||0)<=t?e+(r||0):0|(t-1)/(n+(i||0))*(e+(r||0))+1:0}m.prototype.push_index=function(t,n,e,i,r,o){let s=o?this.ctx:this.map;if((!t[n]||o&&!t[n][o])&&(this.optimize&&(s=s[e]),o?(t=t[n]||(t[n]=a()),t[o]=1,s=s[o]||(s[o]=a())):t[n]=1,s=s[n]||(s[n]=[]),this.optimize||(s=s[e]||(s[e]=[])),(!r||!s.includes(i))&&(s[s.length]=i,this.fastupdate))){const h=this.register[i]||(this.register[i]=[]);h[h.length]=s}},m.prototype.search=function(t,n,e){e||(!n&&$(t)?(e=t,t=e.query):$(n)&&(e=n));let i,r,o,s=[],h=0;if(e&&(t=e.query||t,n=e.limit,h=e.offset||0,r=e.context,o=e.suggest),t&&(t=this.encode(""+t),i=t.length,1<i)){const c=a(),d=[];for(let f,g=0,y=0;g<i;g++)if(f=t[g],f&&f.length>=this.minlength&&!c[f]){if(!this.optimize&&!o&&!this.map[f])return s;d[y++]=f,c[f]=1}t=d,i=t.length}if(!i)return s;n||(n=100);let p,l=this.depth&&1<i&&r!==!1,u=0;l?(p=t[0],u=1):1<i&&t.sort(F);for(let c,d;u<i;u++){if(d=t[u],l?(c=this.add_result(s,o,n,h,i===2,d,p),(!o||c!==!1||!s.length)&&(p=d)):c=this.add_result(s,o,n,h,i===1,d),c)return c;if(o&&u==i-1){let f=s.length;if(!f){if(l){l=0,u=-1;continue}return s}if(f===1)return J(s[0],n,h)}}return nt(s,n,h,o)},m.prototype.add_result=function(t,n,e,i,r,o,s){let h=[],p=s?this.ctx:this.map;if(this.optimize||(p=L(p,o,s,this.bidirectional)),p){let l=0;const u=Math.min(p.length,s?this.resolution_ctx:this.resolution);for(let c,d,f=0,g=0;f<u&&(c=p[f],!(c&&(this.optimize&&(c=L(c,o,s,this.bidirectional)),i&&c&&r&&(d=c.length,d<=i?(i-=d,c=null):(c=c.slice(i),i=0)),c&&(h[l++]=c,r&&(g+=c.length,g>=e)))));f++);if(l)return r?J(h,e,0):void(t[t.length]=h)}return!n&&h};function J(t,n,e){return t=t.length===1?t[0]:D(t),e||t.length>n?t.slice(e,e+n):t}function L(t,n,e,i){if(e){const r=i&&n>e;t=t[r?n:e],t=t&&t[r?e:n]}else t=t[n];return t}m.prototype.contain=function(t){return!!this.register[t]},m.prototype.update=function(t,n){return this.remove(t).add(t,n)},m.prototype.remove=function(t,n){const e=this.register[t];if(e){if(this.fastupdate)for(let i,r=0;r<e.length;r++)i=e[r],i.splice(i.indexOf(t),1);else M(this.map,t,this.resolution,this.optimize),this.depth&&M(this.ctx,t,this.resolution_ctx,this.optimize);n||delete this.register[t],this.cache&&this.cache.del(t)}return this};function M(t,n,e,i,r){let o=0;if(G(t))if(r){const s=t.indexOf(n);s===-1?o++:1<t.length&&(t.splice(s,1),o++)}else{r=Math.min(t.length,e);for(let s,h=0;h<r;h++)s=t[h],s&&(o=M(s,n,e,i,r),!i&&!o&&delete t[h])}else for(let s in t)o=M(t[s],n,e,i,r),o||delete t[s];return o}m.prototype.searchCache=it,m.prototype.export=ht,m.prototype.import=ct,et(m.prototype);const lt=m.Index??m;let N=!1,A;const P=new Map,R=new Map;function ut(t){if(N)return;const n=Math.max(...t.map(e=>e.rank??0));A=Array.from({length:n+1},()=>new lt({tokenize:"forward"}));for(const e of t){const i=e.breadcrumbs.at(-1);P.set(e.href,e),A[e.rank??0].add(e.href,`${i} ${e.content}`),R.set(e.breadcrumbs.join("::"),e.href)}N=!0}function ft(t){const n=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e=new RegExp(`(^|\\b)${n}`,"i"),i=A.flatMap(o=>o.search(t)).map(T).map((o,s)=>({block:o,rank:s})).sort((o,s)=>{const h=e.test(o.block.breadcrumbs.at(-1)),p=e.test(s.block.breadcrumbs.at(-1));return h!==p?h?-1:1:o.block.breadcrumbs.length-s.block.breadcrumbs.length||o.rank-s.rank}).map(({block:o})=>o);return B([],i).children}function T(t){return P.get(t)}function B(t,n){const e=t.length,i=n.find(s=>s.breadcrumbs.length!==e?!1:t.every((h,p)=>s.breadcrumbs[p]===h)),r=n.filter(s=>s.breadcrumbs.length<=e?!1:t.every((h,p)=>s.breadcrumbs[p]===h)),o=Array.from(new Set(r.map(s=>s.breadcrumbs[e])));return{breadcrumbs:t,href:R.get(t.join("::")),node:i,children:o.map(s=>B([...t,s],r))}}addEventListener("message",async t=>{const{type:n,payload:e}=t.data;if(n==="init"){const i=await fetch(`${e.origin}/content.json`),{blocks:r}=await i.json();ut(r),postMessage({type:"ready"})}if(n==="query"){const i=e,r=ft(i);postMessage({type:"results",payload:{results:r,query:i}})}if(n==="recents"){const i=e.map(T).filter(Boolean);postMessage({type:"recents",payload:i})}})})();
